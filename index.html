<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Familiada Static Board</title>
    <!-- Using Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Using Google Fonts for 'Bebas Neue' -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Bebas Neue', sans-serif;
            background-color: #000; /* Solid black background */
            color: #fff;
        }

        .score-box {
            color: #fff;
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .score-box h3 {
            font-size: 1.5rem;
        }
        
        .score-box p {
            font-size: 3rem;
        }

        .question-box {
            background-color: transparent;
            color: #ffcc00; /* Yellow text for question */
            border-radius: 1rem;
            text-align: center;
            font-size: 2.25rem;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            max-width: 80%;
            margin: auto;
        }

        .answer-list {
            margin-top: 4rem;
        }

        .answer-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .answer-number {
            font-size: 2.5rem;
            color: #ffcc00;
            padding-right: 1.5rem;
            line-height: 1;
        }

        .answer-line-container {
            flex-grow: 1;
            position: relative;
            height: 40px;
        }

        .answer-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            transform: translateY(-50%);
            border-bottom: 4px solid #ffcc00;
        }
        
        .answer-text {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            font-size: 2rem;
            color: #000;
            background-color: #ffcc00;
            padding: 0.25rem 0.5rem;
        }
        
        .answer-value {
            font-size: 2rem;
            color: #fff;
            padding-left: 1.5rem;
            line-height: 1;
        }
        
        .strike-icon {
            font-size: 2rem;
            color: #ffcc00; /* Changed to yellow */
            text-shadow: 1px 1px 2px #000;
        }
        
        /* Control Panel Styles */
        .control-panel {
            background-color: #111;
            color: #fff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            max-width: 768px; /* Increased width */
            margin-left: auto;
            margin-right: auto;
        }

        .control-panel button {
            transition: background-color 0.2s;
        }

        .control-panel button:hover {
            opacity: 0.8;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #111;
            color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        /* Highlight Animation */
        @keyframes pulse-highlight {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        .highlighted {
            animation: pulse-highlight 1.5s infinite;
        }
        
        /* Toggle button styles */
        .toggle-btn {
            background-color: #4a5568;
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .toggle-btn.active {
            background-color: #10b981; /* Green color for active state */
        }

        .dotted-line {
            letter-spacing: 0.5rem;
        }

        .cursor-pointer {
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-black min-h-screen p-8 flex flex-col items-center justify-center">

    <!-- Top Score and Question Area -->
    <div class="w-full max-w-5xl flex justify-between items-start mb-12">
        <!-- Team A Score -->
        <div id="scoreBoxA" class="score-box bg-red-600">
            <h3 id="teamNameA" class="font-bold">RODZINA 1</h3>
            <p id="scoreA" class="font-bold">0</p>
        </div>
        
        <!-- Question Box -->
        <div class="question-box p-4 font-bold">
            <p id="question" class="dotted-line">...</p>
        </div>

        <!-- Team B Score -->
        <div id="scoreBoxB" class="score-box bg-blue-600">
            <h3 id="teamNameB" class="font-bold">RODZINA 2</h3>
            <p id="scoreB" class="font-bold">0</p>
        </div>
    </div>

    <!-- Main Game Board and Strikes Display -->
    <div class="w-full max-w-5xl flex items-center justify-between">
        <!-- Strikes for Team A (Left side) -->
        <div id="strikesA" class="flex flex-col items-center w-1/4"></div>

        <!-- Main Game Board -->
        <div class="flex-shrink-0 w-1/2 flex flex-col items-center">
            <!-- Display for Current Points -->
            <div id="currentPointsDisplay" class="text-yellow-500 font-bold text-5xl mb-4">0</div>
            
            <div id="gameBoard" class="text-yellow-500 font-bold answer-list w-full">
                <!-- Answers will be dynamically inserted here -->
            </div>
        </div>

        <!-- Strikes for Team B (Right side) -->
        <div id="strikesB" class="flex flex-col items-center w-1/4"></div>
    </div>

    <!-- Mode Toggle Button -->
    <div class="mt-8 w-full max-w-md flex justify-end">
        <button id="modeToggleBtn" class="bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg">
            Show Controls
        </button>
    </div>

    <!-- Control Panel (initially hidden) -->
    <div id="controlPanel" class="control-panel w-full max-w-3xl mt-8 hidden">
        <h3 class="text-xl font-bold mb-4 text-center">Control Panel</h3>
        <!-- Displays for current question and points -->
        <div class="mb-4 text-center">
            <h4 class="text-lg font-semibold text-yellow-500">Current Question:</h4>
            <p id="controlQuestionDisplay" class="text-lg italic mb-2"></p>
        </div>
        <!-- New element to display the number of questions remaining -->
        <div class="mb-4 text-center">
            <p id="questionsLeftDisplay" class="text-sm text-gray-400">Questions Remaining: <span id="questionsLeftCount">15</span></p>
        </div>

        <!-- Main control grid with buttons and answers -->
        <div class="grid grid-cols-3 gap-4 items-start">
            <!-- Team A Buttons -->
            <div class="flex flex-col space-y-4">
                <button id="addPointsA" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg">
                    Add Points Team A
                </button>
                <div class="flex flex-row space-x-2">
                    <button id="addStrikeA" class="bg-gray-700 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">
                        Add Strike
                    </button>
                    <button id="removeStrikeA" class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-lg">
                        Remove Strike
                    </button>
                </div>
                <div class="flex flex-col space-y-2 mt-4">
                    <span class="text-gray-400 text-sm">Active Team</span>
                    <button id="teamAToggle" class="toggle-btn bg-gray-700">
                        RODZINA 1
                    </button>
                </div>
            </div>

            <!-- Answers List with Checkboxes -->
            <div id="controlAnswerList" class="flex flex-col space-y-2">
                <!-- Answers will be dynamically inserted here -->
            </div>
            
            <!-- Team B Buttons -->
            <div class="flex flex-col space-y-4">
                <button id="addPointsB" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg">
                    Add Points Team B
                </button>
                <div class="flex flex-row space-x-2">
                    <button id="addStrikeB" class="bg-gray-700 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                        Add Strike
                    </button>
                    <button id="removeStrikeB" class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-lg">
                        Remove Strike
                    </button>
                </div>
                <div class="flex flex-col space-y-2 mt-4">
                    <span class="text-gray-400 text-sm">Active Team</span>
                    <button id="teamBToggle" class="toggle-btn bg-gray-700">
                        RODZINA 2
                    </button>
                </div>
            </div>
        </div>

        <!-- Global control buttons below the main grid -->
        <div class="grid grid-cols-2 gap-4 mt-8">
            <button id="nextQuestionBtn" class="bg-purple-600 text-white font-bold py-3 px-4 rounded-lg">
                Next Question
            </button>
            <button id="resetBoard" class="bg-gray-500 text-white font-bold py-3 px-4 rounded-lg">
                Reset Game (Full)
            </button>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h4 class="text-2xl font-bold mb-4">Are you sure?</h4>
            <p class="mb-6">This will reset the entire game, including scores and questions.</p>
            <div class="flex justify-center space-x-4">
                <button id="confirmYes" class="bg-red-600 text-white font-bold py-2 px-6 rounded-lg">Yes</button>
                <button id="confirmNo" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">No</button>
            </div>
        </div>
    </div>

    <!-- Start Game Modal (New) -->
    <div id="startModal" class="modal-overlay">
        <div class="modal-content">
            <h4 class="text-2xl font-bold mb-4">Wpisz nazwy drużyn</h4>
            <form id="startGameForm" class="flex flex-col space-y-4">
                <div class="flex flex-col items-start w-full">
                    <label for="team1Name" class="text-sm font-semibold mb-1">RODZINA 1:</label>
                    <input type="text" id="team1Name" placeholder="Nazwa Rodziny 1" autocomplete="off" class="w-full p-2 rounded-lg bg-gray-800 text-white">
                </div>
                <div class="flex flex-col items-start w-full">
                    <label for="team2Name" class="text-sm font-semibold mb-1">RODZINA 2:</label>
                    <input type="text" id="team2Name" placeholder="Nazwa Rodziny 2" autocomplete="off" class="w-full p-2 rounded-lg bg-gray-800 text-white">
                </div>
                <button type="submit" id="startGameBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg cursor-pointer">
                    Rozpocznij Grę
                </button>
            </form>
        </div>
    </div>
    
    <script>
        // Game data - change this to create new questions and answers
        const allGameData = [
            {
                question: "Wymień najbardziej znane modele AI",
                answers: [
                    { answer: "ChatGPT (OpenAI)", value: 39 },
                    { answer: "Claude (Anthropic)", value: 32 },
                    { answer: "Gemini (Google)", value: 28 },
                    { answer: "Copilot", value: 22 },
                    { answer: "Midjourney", value: 16 },
                    { answer: "Runway", value: 11 }
                ]
            },
            {
                question: "Wymień najbardziej znane platformy streamingowe",
                answers: [
                    { answer: "Netflix", value: 44 },
                    { answer: "YouTube", value: 38 },
                    { answer: "Amazon Prime Video", value: 29 },
                    { answer: "Disney+", value: 25 },
                    { answer: "HBO Max", value: 19 },
                    { answer: "Spotify", value: 14 }
                ]
            },
            {
                question: "Najbardziej przehype’owany deser to",
                answers: [
                    { answer: "Dubajska czekolada", value: 36 },
                    { answer: "Jagodzianka", value: 33 },
                    { answer: "Rolls", value: 27 },
                    { answer: "Wszystko z matcha", value: 22 },
                    { answer: "Pączki", value: 18 },
                    { answer: "Sernik Baskijski", value: 9 }
                ]
            },
            {
                question: "Wymień znane polskie teleturnieje",
                answers: [
                    { answer: "Familiada", value: 48 },
                    { answer: "Milionerzy", value: 41 },
                    { answer: "Jaka to melodia", value: 33 },
                    { answer: "Awantura o kasę", value: 21 },
                    { answer: "Postaw na milion", value: 16 },
                    { answer: "Idź na całość", value: 7}
                ]
            },
            {
                question: "Więcej niż jedno zwierze to ...",
                answers: [
                    { answer: "Lama", value: 43 },
                    { answer: "Owca", value: 36 },
                    { answer: "Stado", value: 25 },
                    { answer: "Wataha", value: 28 },
                    { answer: "Ławica", value: 13 },
                    { answer: "Sfora", value: 11 }
                ]
            },
            {
                question: "Wymień popularne młodzieżowe słowa roku",
                answers: [
                    { answer: "Sigma", value: 44 },
                    { answer: "Delulu", value: 35 },
                    { answer: "Rizz", value: 31 },
                    { answer: "Skibidi", value: 25 },
                    { answer: "GOAT", value: 21 },
                    { answer: "Essa", value: 15 }
                ]
            },
            {
                question: "Wymień urządzenia, które zrewolucjonizowały nasze życie w XXI wieku",
                answers: [
                    { answer: "Smartfon", value: 46 },
                    { answer: "Laptop", value: 38 },
                    { answer: "Tablet", value: 27 },
                    { answer: "Smartwatch", value: 22 },
                    { answer: "Kamera internetowa", value: 17 },
                    { answer: "Słuchawki bezprzewodowe", value: 12 }
                ]
            },
            {
                question: "Wymień kultowe marki mody",
                answers: [
                    { answer: "Gucci", value: 42 },
                    { answer: "Louis Vuitton", value: 39 },
                    { answer: "Prada", value: 36 },
                    { answer: "Balenciaga", value: 27 },
                    { answer: "Dior", value: 21 },
                    { answer: "Versace", value: 16 }
                ]
            },
            {
                question: "Wymień najbardziej znaną postać z Harry'ego Pottera",
                answers: [
                    { answer: "HARRY POTTER", value: 38 },
                    { answer: "HERMIONA GRANGER", value: 35 },
                    { answer: "RON WEASLEY", value: 31 },
                    { answer: "ALBUS DUMBLEDORE", value: 26 },
                    { answer: "VOLDEMORT", value: 22 },
                    { answer: "SEVERUS SNAPE", value: 18 }
                ]
            },
            {
                question: "Wymień popularne zespoły rockowe z przełomu lat 90/00",
                answers: [
                    { answer: "Linkin Park", value: 38 },
                    { answer: "30 Seconds to Mars", value: 34 },
                    { answer: "Red Hot Chili Peppers", value: 29 },
                    { answer: "My Chemical Romance", value: 24 },
                    { answer: "Evanescence", value: 21 },
                    { answer: "Green Day", value: 17 }
                ]
            },
            {
                question: "Planszowe, komputerowe lub podwórkowe - wymień najpopularniejsze gry z dzieciństwa",
                answers: [
                    { answer: "Super Mario", value: 33 },
                    { answer: "Eurobisness", value: 31 },
                    { answer: "Tetris", value: 26 },
                    { answer: "Tamagotchi", value: 22 },
                    { answer: "Gra w karty", value: 15 },
                    { answer: "The Sims", value: 11 }
                ]
            },
            {
                question: "Fuji to",
                answers: [
                    { answer: "Pies", value: 43 },
                    { answer: "Góra", value: 36 },
                    { answer: "Wulkan", value: 33 },
                    { answer: "Lis", value: 27 },
                    { answer: "Kot", value: 21 },
                    { answer: "Symbol Japonii", value: 16 }
                ]
            },
            {
                question: "Wymień serial, o którym wszyscy mówili w latach 2010–2025",
                answers: [
                    { answer: "Gra o tron", value: 43 },
                    { answer: "Stranger Things", value: 38 },
                    { answer: "Squid Game", value: 33 },
                    { answer: "Breaking Bad", value: 28 },
                    { answer: "Black Mirror", value: 21 },
                    { answer: "The Last of Us", value: 15 }
                ]
            },
            {
                question: "Wymień modę żywieniową ostatnich lat",
                answers: [
                    { answer: "Keto", value: 44 },
                    { answer: "Post przerywany (okienko żywieniowe)", value: 41 },
                    { answer: "Dieta paleo", value: 36 },
                    { answer: "Carnivore", value: 29 },
                    { answer: "Dieta sokowa", value: 22 },
                    { answer: "Dieta bezglutenowa", value: 15 }
                ]
            },
            {
                question: "Wymień znane pary ze świata showbusinessu (kiedyś i dziś)",
                answers: [
                    { answer: "Beyoncé i Jay-Z", value: 37 },
                    { answer: "Kim Kardashian i Kanye West", value: 33 },
                    { answer: "Brad Pitt i Angelina Jolie", value: 29 },
                    { answer: "David i Victoria Beckham", value: 25 },
                    { answer: "Britney Spears i Justin Timberlake", value: 19 },
                    { answer: "Zendaya i Tom Holland", value: 11 }
                ]
            }
        ];

        // Key for localStorage
        const localStorageKey = 'familiadaGameState';

        // Get all the HTML elements
        const modeToggleBtn = document.getElementById('modeToggleBtn');
        const controlPanelEl = document.getElementById('controlPanel');
        const questionEl = document.getElementById('question');
        const gameBoardEl = document.getElementById('gameBoard');
        const scoreAEl = document.getElementById('scoreA');
        const scoreBEl = document.getElementById('scoreB');
        const scoreBoxA = document.getElementById('scoreBoxA');
        const scoreBoxB = document.getElementById('scoreBoxB');
        const teamNameAEl = document.getElementById('teamNameA');
        const teamNameBEl = document.getElementById('teamNameB');
        const addPointsA = document.getElementById('addPointsA');
        const addPointsB = document.getElementById('addPointsB');
        const addStrikeA = document.getElementById('addStrikeA');
        const removeStrikeA = document.getElementById('removeStrikeA');
        const addStrikeB = document.getElementById('addStrikeB');
        const removeStrikeB = document.getElementById('removeStrikeB');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const resetBtn = document.getElementById('resetBoard');
        const strikesAEl = document.getElementById('strikesA');
        const strikesBEl = document.getElementById('strikesB');
        const currentPointsDisplay = document.getElementById('currentPointsDisplay');
        const controlAnswerListEl = document.getElementById('controlAnswerList');
        const controlQuestionDisplayEl = document.getElementById('controlQuestionDisplay');
        const teamAToggle = document.getElementById('teamAToggle');
        const teamBToggle = document.getElementById('teamBToggle');
        // New elements for the question counter
        const questionsLeftDisplay = document.getElementById('questionsLeftDisplay');
        const questionsLeftCount = document.getElementById('questionsLeftCount');

        // Modal elements for reset confirmation
        const confirmModal = document.getElementById('confirmModal');
        const confirmYesBtn = document.getElementById('confirmYes');
        const confirmNoBtn = document.getElementById('confirmNo');

        // New start modal elements
        const startModal = document.getElementById('startModal');
        const startGameForm = document.getElementById('startGameForm');
        const team1NameInput = document.getElementById('team1Name');
        const team2NameInput = document.getElementById('team2Name');

        // Game state variables
        let gameState = {
            scoreA: 0,
            scoreB: 0,
            strikesA: 0,
            strikesB: 0,
            boardState: [],
            currentPoints: 0,
            currentQuestionIndex: 0,
            availableQuestions: [], // New array to track available question indices
            activeTeam: null, // 'A' or 'B'
            questionRevealed: false,
            teamNameA: 'RODZINA 1',
            teamNameB: 'RODZINA 2'
        };

        // Function to load game state from localStorage
        function loadGameState() {
            const storedState = localStorage.getItem(localStorageKey);
            if (storedState) {
                gameState = JSON.parse(storedState);
                if (gameState.currentQuestionIndex === undefined || !allGameData[gameState.currentQuestionIndex]) {
                    // If the stored state is invalid or missing the question index, reset to the first question
                    gameState.currentQuestionIndex = 0;
                    if (!gameState.availableQuestions || gameState.availableQuestions.length === 0) {
                        initializeAvailableQuestions();
                    }
                }
                // Check if team names are present, otherwise show the start modal
                if (!gameState.teamNameA || !gameState.teamNameB) {
                    showStartModal();
                } else {
                    updateTeamNamesDisplay();
                    renderBoard();
                    renderControlPanelAnswers();
                    highlightActiveTeam();
                    updateQuestionsLeftDisplay();
                }
            } else {
                // If no state exists, show the start modal to set names
                showStartModal();
            }
        }
        
        // Function to initialize the available questions array
        function initializeAvailableQuestions() {
            gameState.availableQuestions = Array.from({length: allGameData.length}, (_, i) => i);
        }

        // Function to save game state to localStorage
        function saveGameState() {
            localStorage.setItem(localStorageKey, JSON.stringify(gameState));
        }

        // Function to render the game board based on current state
        function renderBoard() {
            gameBoardEl.innerHTML = '';
            // Check if there are questions left before rendering
            if (gameState.availableQuestions.length === 0 && gameState.questionRevealed === false) {
                 questionEl.textContent = 'GAME OVER!';
                 return;
            }
            const currentQuestion = allGameData[gameState.currentQuestionIndex].question;
            const currentPoints = gameState.currentPoints;

            // Update main board displays based on questionRevealed state
            if (gameState.questionRevealed) {
                questionEl.textContent = currentQuestion;
            } else {
                questionEl.textContent = '...';
            }
            currentPointsDisplay.textContent = currentPoints;

            // Update control panel displays
            controlQuestionDisplayEl.textContent = currentQuestion;

            gameState.boardState.forEach((item, index) => {
                const answerItem = document.createElement('div');
                answerItem.classList.add('answer-item');
                answerItem.innerHTML = `
                    <span class="answer-number">${index + 1}.</span>
                    <div class="answer-line-container">
                        <div class="answer-line"></div>
                        ${item.revealed ? `<span class="answer-text">${item.answer}</span>` : ''}
                    </div>
                    <span class="answer-value">${item.revealed ? item.value : ''}</span>
                `;
                gameBoardEl.appendChild(answerItem);
            });
            updateScores();
        }

        // Function to render the answers list in the control panel
        function renderControlPanelAnswers() {
            controlAnswerListEl.innerHTML = ''; // Clear previous answers
            // If the game is over, do not render answers
            if (gameState.availableQuestions.length === 0 && gameState.questionRevealed === false) {
                controlAnswerListEl.innerHTML = '<p class="text-white text-center">No more questions available. Please reset the game.</p>';
                return;
            }
            gameState.boardState.forEach((item, index) => {
                const answerItem = document.createElement('div');
                answerItem.classList.add('flex', 'items-center', 'space-x-2');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `answer-${index}`;
                checkbox.classList.add('h-5', 'w-5', 'text-yellow-500', 'rounded', 'border-gray-300', 'focus:ring-yellow-500', 'cursor-pointer');
                checkbox.checked = item.revealed;
                checkbox.disabled = item.revealed;
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        revealAnswer(index);
                    }
                });
                const label = document.createElement('label');
                label.htmlFor = `answer-${index}`;
                label.classList.add('text-lg', 'font-semibold', 'cursor-pointer');
                label.textContent = `${item.answer} (${item.value})`;
                answerItem.appendChild(checkbox);
                answerItem.appendChild(label);
                controlAnswerListEl.appendChild(answerItem);
            });
        }
        
        // Function to reveal an answer
        function revealAnswer(index) {
            if (index >= 0 && index < gameState.boardState.length) {
                const answer = gameState.boardState[index];
                if (!answer.revealed) {
                    answer.revealed = true;
                    gameState.currentPoints += answer.value;

                    if (!gameState.questionRevealed) {
                        gameState.questionRevealed = true;
                        questionEl.textContent = allGameData[gameState.currentQuestionIndex].question;
                    }

                    saveGameState();
                    renderBoard(); 
                    renderControlPanelAnswers(); // Re-render to disable the revealed checkbox
                }
            }
        }

        // Function to update the score display
        function updateScores() {
            scoreAEl.textContent = gameState.scoreA;
            scoreBEl.textContent = gameState.scoreB;
            updateStrikesDisplay();
        }

        // Function to update the strikes display on the main board
        function updateStrikesDisplay() {
            strikesAEl.innerHTML = '';
            for (let i = 0; i < gameState.strikesA; i++) {
                const strike = document.createElement('span');
                strike.classList.add('strike-icon');
                strike.textContent = '❌';
                strikesAEl.appendChild(strike);
            }
            strikesBEl.innerHTML = '';
            for (let i = 0; i < gameState.strikesB; i++) {
                const strike = document.createElement('span');
                strike.classList.add('strike-icon');
                strike.textContent = '❌';
                strikesBEl.appendChild(strike);
            }
        }

        // Function to highlight the active team's score box and toggle button
        function highlightActiveTeam() {
            scoreBoxA.classList.remove('highlighted');
            scoreBoxB.classList.remove('highlighted');
            teamAToggle.classList.remove('active');
            teamBToggle.classList.remove('active');

            if (gameState.activeTeam === 'A') {
                scoreBoxA.classList.add('highlighted');
                teamAToggle.classList.add('active');
            } else if (gameState.activeTeam === 'B') {
                scoreBoxB.classList.add('highlighted');
                teamBToggle.classList.add('active');
            }
        }
        
        // Function to update the question count display
        function updateQuestionsLeftDisplay() {
            questionsLeftCount.textContent = gameState.availableQuestions.length;
        }

        // Function to update the team names on the main board and control panel
        function updateTeamNamesDisplay() {
            teamNameAEl.textContent = gameState.teamNameA;
            teamAToggle.textContent = gameState.teamNameA;
            teamNameBEl.textContent = gameState.teamNameB;
            teamBToggle.textContent = gameState.teamNameB;
        }

        // Function to reset the current round (strikes and revealed answers), but keep the score
        function resetRound() {
            // Check if there are any questions left
            if (gameState.availableQuestions.length === 0) {
                alert("All questions have been used. Please reset the entire game to play again.");
                return;
            }
            
            // Select a random, unused question
            // const randomIndex = Math.floor(Math.random() * gameState.availableQuestions.length);
            const randomIndex = 0 ; // disable randomization
            const selectedQuestionIndex = gameState.availableQuestions[randomIndex];
            
            // Set the new question index and remove it from the available list
            gameState.currentQuestionIndex = selectedQuestionIndex;
            gameState.availableQuestions.splice(randomIndex, 1);

            const currentGameData = allGameData[gameState.currentQuestionIndex];
            gameState.strikesA = 0;
            gameState.strikesB = 0;
            gameState.currentPoints = 0;
            gameState.boardState = currentGameData.answers.map(item => ({ ...item, revealed: false }));
            gameState.questionRevealed = false;
            gameState.activeTeam = null;
            saveGameState();
            renderBoard();
            renderControlPanelAnswers();
            highlightActiveTeam();
            updateQuestionsLeftDisplay();
        }

        // Function to start a new game from scratch
        function resetGame() {
            gameState.scoreA = 0;
            gameState.scoreB = 0;
            gameState.currentQuestionIndex = 0;
            gameState.teamNameA = null; // Clear names to trigger start modal
            gameState.teamNameB = null; // Clear names to trigger start modal
            initializeAvailableQuestions(); // Reset available questions
            localStorage.removeItem(localStorageKey);
            showStartModal();
        }
        
        // Function to show the start game modal
        function showStartModal() {
            startModal.classList.remove('hidden');
        }

        // Event listeners for the control panel
        addPointsA.addEventListener('click', () => {
            if (gameState.activeTeam === 'A') {
                gameState.scoreA += gameState.currentPoints;
                gameState.currentPoints = 0;
                saveGameState();
                updateScores();
                renderBoard();
            } else {
                alert("Team A is not the active team! Please select them with the toggle.");
            }
        });

        addPointsB.addEventListener('click', () => {
            if (gameState.activeTeam === 'B') {
                gameState.scoreB += gameState.currentPoints;
                gameState.currentPoints = 0;
                saveGameState();
                updateScores();
                renderBoard();
            } else {
                alert("Team B is not the active team! Please select them with the toggle.");
            }
        });

        addStrikeA.addEventListener('click', () => {
            if (gameState.strikesA < 3) {
                gameState.strikesA++;
                saveGameState();
                updateStrikesDisplay();
            }
        });

        removeStrikeA.addEventListener('click', () => {
            if (gameState.strikesA > 0) {
                gameState.strikesA--;
                saveGameState();
                updateStrikesDisplay();
            }
        });

        addStrikeB.addEventListener('click', () => {
            if (gameState.strikesB < 3) {
                gameState.strikesB++;
                saveGameState();
                updateStrikesDisplay();
            }
        });

        removeStrikeB.addEventListener('click', () => {
            if (gameState.strikesB > 0) {
                gameState.strikesB--;
                saveGameState();
                updateStrikesDisplay();
            }
        });

        // Event listeners for the new toggle buttons
        teamAToggle.addEventListener('click', () => {
            gameState.activeTeam = 'A';
            saveGameState();
            highlightActiveTeam();
        });

        teamBToggle.addEventListener('click', () => {
            gameState.activeTeam = 'B';
            saveGameState();
            highlightActiveTeam();
        });


        nextQuestionBtn.addEventListener('click', () => {
            resetRound();
        });
        
        // Event listener for the custom confirmation modal on reset
        resetBtn.addEventListener('click', () => {
            confirmModal.classList.remove('hidden');
        });

        confirmYesBtn.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
            resetGame();
        });
        
        confirmNoBtn.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
        });

        // The logic for handling the form submission has been updated to prevent an unnecessary reset.
        startGameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const team1Name = team1NameInput.value.trim() || 'RODZINA 1';
            const team2Name = team2NameInput.value.trim() || 'RODZINA 2';
            
            gameState.teamNameA = team1Name;
            gameState.teamNameB = team2Name;
            
            // Re-initialize the board state for the first question without resetting scores or strikes.
            initializeAvailableQuestions();
            resetRound(); // This will select the first random question
            
            saveGameState();
            updateTeamNamesDisplay();
            startModal.classList.add('hidden');
            renderBoard();
            renderControlPanelAnswers();
            highlightActiveTeam();
            updateQuestionsLeftDisplay();
        });

        // Listen for changes in localStorage from other tabs/windows
        window.addEventListener('storage', (e) => {
            if (e.key === localStorageKey) {
                loadGameState();
            }
        });

        // Toggle between display and control mode
        modeToggleBtn.addEventListener('click', () => {
            const isControlMode = controlPanelEl.classList.contains('hidden');
            if (isControlMode) {
                controlPanelEl.classList.remove('hidden');
                modeToggleBtn.textContent = 'Hide Controls';
            } else {
                controlPanelEl.classList.add('hidden');
                modeToggleBtn.textContent = 'Show Controls';
            }
        });

        // This is a simple function to replace the native alert() which is blocked in this environment
        function alert(message) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                padding: 24px; background-color: #333; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                display: flex; flex-direction: column; align-items: center; z-index: 1000;
                max-width: 320px; text-align: center; color: white;
            `;
            const messageText = document.createElement('p');
            messageText.textContent = message;
            messageText.style.cssText = 'font-size: 16px; margin-bottom: 16px;';
            const okButton = document.createElement('button');
            okButton.textContent = 'OK';
            okButton.style.cssText = `
                background-color: #4a5568; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 500; cursor: pointer;
            `;
            okButton.onclick = () => { modal.remove(); };
            modal.appendChild(messageText);
            modal.appendChild(okButton);
            document.body.appendChild(modal);
        }

        // Initialize the board and control answers when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadGameState();
        });
    </script>
</body>
</html>
